version: "3.9"
services:
  bottrader:
    build:
      context: .
      dockerfile: docker/Dockerfile.bot
    image: bottrader:latest
    container_name: bottrader
    restart: unless-stopped
    environment:
      TZ: "UTC"
      AWS_REGION: "us-west-2"
      AWS_DEFAULT_REGION: "us-west-2"
      AWS_PAGER: ""
      AWS_CLI_PAGER: ""
      SSM_PREFIX: "/bottrader/prod/db"
      LOG_LEVEL: "INFO"
      IS_DOCKER: "true"
      IN_DOCKER: "1"
    command: [ "bash", "-lc", ". /usr/local/bin/ssm-env && python -m main --run both" ]
    ports:
      - "5003:5003"
    volumes:
      - ./logs:/app/logs
    logging:
      driver: "local"
      options:
        max-size: "10m"
        max-file: "5"

  report-once:
    build:
      context: .
      dockerfile: docker/Dockerfile.report
    image: bottrader-report:latest
    container_name: bottrader-report
    environment:
      TZ: "UTC"
      AWS_REGION: "us-west-2"
      AWS_DEFAULT_REGION: "us-west-2"
      AWS_PAGER: ""
      AWS_CLI_PAGER: ""
      SSM_PREFIX: "/bottrader/prod/db"
      IS_DOCKER: "true"
      IN_DOCKER: "1"
    command: [ "bash", "-lc", ". /usr/local/bin/ssm-env && python BotTrader/database_manager/aws_daily_report.py" ]
    logging:
      driver: "local"
      options:
        max-size: "5m"
        max-file: "3"
