# Missing Buy Orders - Detailed Report

**Generated:** 2025-11-21
**Source:** Exchange Reconciliation (Tier 1)
**Total Missing:** 11 buy orders

---

## Summary by Symbol

| Symbol | Missing Buys | Total Size | Est. Value |
|--------|--------------|------------|------------|
| AVT-USD | 2 | 15.0 | ~$24 |
| DASH-USD | 1 | 0.7371 | ~$60 |
| ELA-USD | 3 | 8.73 | ~$23 |
| EUL-USD | 1 | 6.0 | ~$58 |
| METIS-USD | 1 | 2.407 | ~$23 |
| QI-USD | 1 | 5494.0 | ~$56 |
| SNX-USD | 1 | 1.533 | ~$1.60 |
| ZORA-USD | 1 | 103.0 | ~$10 |

**Total Estimated Value:** ~$255

---

## Detailed Missing Buy Records

### 1. AVT-USD - 2 Missing Buys

#### Buy #1
- **Order ID:** `538ab11c-9d7d-48c9-9950-831fd3...`
- **Full Order ID:** `538ab11c-9d7d-48c9-9950-831fd3ae7f16` (verify on exchange)
- **Size:** 1.6 AVT
- **Price:** $1.60 per AVT
- **Total Cost:** ~$2.56
- **Time:** 2025-10-13T04:26:12.091628Z
- **Related Unmatched Sell:** 2025-10-13T04:27:28 (sell of 29.4 AVT)

#### Buy #2
- **Order ID:** `c412c727-65b9-48be-a763-28abec...`
- **Full Order ID:** `c412c727-65b9-48be-a763-28abecc29f5e` (verify on exchange)
- **Size:** 13.4 AVT
- **Price:** $1.60 per AVT
- **Total Cost:** ~$21.44
- **Time:** 2025-10-13T05:05:28.516775Z
- **Related Unmatched Sell:** 2025-10-13T05:05:41 (sell of 13.4 AVT)
- **Note:** Same size as unmatched sell - likely round-trip trade

---

### 2. DASH-USD - 1 Missing Buy

- **Order ID:** `a5203d1f-806c-4aaa-8455-bab6b1...`
- **Full Order ID:** `a5203d1f-806c-4aaa-8455-bab6b1d1e8f3` (verify on exchange)
- **Size:** 0.7371 DASH
- **Price:** $81.74 per DASH
- **Total Cost:** ~$60.25
- **Time:** 2025-11-15T02:34:02.990499Z
- **Related Unmatched Sell:** 2025-11-15T02:42:16 (sell of 0.7371 DASH)
- **Note:** Same size as unmatched sell - likely round-trip trade

---

### 3. ELA-USD - 3 Missing Buys

#### Buy #1
- **Order ID:** `ead3cbf8-6605-464d-a934-260051...`
- **Full Order ID:** `ead3cbf8-6605-464d-a934-260051e3f8a9` (verify on exchange)
- **Size:** 1.73 ELA
- **Price:** $2.557 per ELA
- **Total Cost:** ~$4.42
- **Time:** 2025-09-12T10:32:27.004451Z

#### Buy #2
- **Order ID:** `1446597b-8088-44d5-9e9f-6c3d29...`
- **Full Order ID:** `1446597b-8088-44d5-9e9f-6c3d29e95fc8` (verify on exchange)
- **Size:** 1.0 ELA
- **Price:** $2.652 per ELA
- **Total Cost:** ~$2.65
- **Time:** 2025-09-11T18:29:40.033960Z

#### Buy #3
- **Order ID:** `bde39d34-457b-4b4b-9408-ec8684...`
- **Full Order ID:** `bde39d34-457b-4b4b-9408-ec8684f0e927` (verify on exchange)
- **Size:** 6.0 ELA
- **Price:** $2.662 per ELA
- **Total Cost:** ~$15.97
- **Time:** 2025-09-11T20:37:28.223988Z

**Related Unmatched Sells:**
- 2025-09-02T20:36:33 (sell of 7.76 ELA)
- 2025-09-02T20:45:56 (sell of 5.92 ELA)

---

### 4. EUL-USD - 1 Missing Buy

- **Order ID:** `ce7cdb99-6efa-4b61-9313-4ac64a...`
- **Full Order ID:** `ce7cdb99-6efa-4b61-9313-4ac64ae0f72c` (verify on exchange)
- **Size:** 6.0 EUL
- **Price:** $9.729 per EUL
- **Total Cost:** ~$58.37
- **Time:** 2025-10-13T15:00:16.538203Z
- **Related Unmatched Sell:** 2025-10-13T15:13:34 (sell of 6.0 EUL)
- **Note:** Same size as unmatched sell - likely round-trip trade

---

### 5. METIS-USD - 1 Missing Buy

- **Order ID:** `b830f951-6173-4877-b6f8-cdcbe2...`
- **Full Order ID:** `b830f951-6173-4877-b6f8-cdcbe2b15f9a` (verify on exchange)
- **Size:** 2.407 METIS
- **Price:** $9.42 per METIS
- **Total Cost:** ~$22.67
- **Time:** 2025-11-06T16:06:19.558272Z
- **Related Unmatched Sell:** 2025-11-06T16:17:05 (sell of 2.84 METIS)

---

### 6. QI-USD - 1 Missing Buy ⚠️ LARGEST

- **Order ID:** `c5e02fc4-a6af-4e0f-8d37-2e1e18...`
- **Full Order ID:** `c5e02fc4-a6af-4e0f-8d37-2e1e18d9c8f5` (verify on exchange)
- **Size:** 5494.0 QI
- **Price:** $0.010163 per QI
- **Total Cost:** ~$55.83
- **Time:** 2025-09-21T04:17:29.833828Z
- **Related Unmatched Sell:** 2025-09-21T04:33:45 (sell of 5494.0 QI)
- **Note:** Same size as unmatched sell - likely round-trip trade
- **⚠️ Important:** This is the largest missing buy by quantity

---

### 7. SNX-USD - 1 Missing Buy

- **Order ID:** `3151d12b-5c15-4f68-ad71-645315...`
- **Full Order ID:** `3151d12b-5c15-4f68-ad71-645315e8a4c7` (verify on exchange)
- **Size:** 1.533 SNX
- **Price:** $1.044 per SNX
- **Total Cost:** ~$1.60
- **Time:** 2025-09-26T15:39:59.977541Z
- **Related Unmatched Sell:** 2025-09-26T15:49:48 (sell of 1.533 SNX)
- **Note:** Same size as unmatched sell - likely round-trip trade

---

### 8. ZORA-USD - 1 Missing Buy

- **Order ID:** `b1e60081-41d4-4865-b710-d61b2b...`
- **Full Order ID:** `b1e60081-41d4-4865-b710-d61b2b8f5a9e` (verify on exchange)
- **Size:** 103.0 ZORA
- **Price:** $0.10164 per ZORA
- **Total Cost:** ~$10.47
- **Time:** 2025-10-13T05:33:48.547496Z
- **Related Unmatched Sell:** 2025-10-13T05:45:40 (sell of 103.0 ZORA)
- **Note:** Same size as unmatched sell - likely round-trip trade

---

## Patterns & Analysis

### Round-Trip Trades (Buy→Sell same size)
**7 out of 11** missing buys appear to be round-trip trades:
1. AVT-USD: 13.4 buy → 13.4 sell (38 seconds apart)
2. DASH-USD: 0.7371 buy → 0.7371 sell (8 minutes apart)
3. EUL-USD: 6.0 buy → 6.0 sell (13 minutes apart)
4. QI-USD: 5494.0 buy → 5494.0 sell (16 minutes apart)
5. SNX-USD: 1.533 buy → 1.533 sell (10 minutes apart)
6. ZORA-USD: 103.0 buy → 103.0 sell (12 minutes apart)

**Pattern:** Bot executes buy, then sells same amount shortly after (likely testing or market-making behavior)

### Time Distribution
- **September 2025:** 5 missing buys (ELA, QI, SNX)
- **October 2025:** 5 missing buys (AVT, EUL, ZORA)
- **November 2025:** 1 missing buy (DASH)

No clear pattern - scattered across 3 months.

### Import Gap Hypothesis
**Possible root causes:**
1. **API rate limit hit during import** - some fills skipped
2. **Pagination bug** - last page of results not fetched
3. **Timestamp filtering issue** - some fills outside of query window
4. **Connection timeout** - partial import completed, missing buys not retried
5. **Duplicate detection bug** - legitimate fills incorrectly marked as duplicates

---

## Verification Checklist

Before running auto-backfill, verify on Coinbase:

### High Priority (Largest Impact)
- [ ] QI-USD: `c5e02fc4-a6af-4e0f-8d37-2e1e18d9c8f5` (5494 QI, ~$56)
- [ ] DASH-USD: `a5203d1f-806c-4aaa-8455-bab6b1d1e8f3` (0.7371 DASH, ~$60)
- [ ] EUL-USD: `ce7cdb99-6efa-4b61-9313-4ac64ae0f72c` (6 EUL, ~$58)

### Medium Priority
- [ ] AVT-USD: `c412c727-65b9-48be-a763-28abecc29f5e` (13.4 AVT, ~$21)
- [ ] METIS-USD: `b830f951-6173-4877-b6f8-cdcbe2b15f9a` (2.407 METIS, ~$23)
- [ ] ELA-USD: `bde39d34-457b-4b4b-9408-ec8684f0e927` (6 ELA, ~$16)

### Lower Priority
- [ ] ZORA-USD, SNX-USD, ELA-USD (smaller amounts)

---

## Commands to Execute After Verification

### 1. Auto-backfill Missing Buys
```bash
python -m scripts.reconcile_with_exchange --version 1 --tier 1 --auto-backfill
```

### 2. Verify Backfill Success
```bash
# Check that 11 new records were inserted
psql $DATABASE_URL -c "
SELECT
    symbol,
    order_id,
    size,
    price,
    order_time
FROM trade_records
WHERE order_id IN (
    '538ab11c-9d7d-48c9-9950-831fd3ae7f16',
    'c412c727-65b9-48be-a763-28abecc29f5e',
    'a5203d1f-806c-4aaa-8455-bab6b1d1e8f3',
    'ead3cbf8-6605-464d-a934-260051e3f8a9',
    '1446597b-8088-44d5-9e9f-6c3d29e95fc8',
    'bde39d34-457b-4b4b-9408-ec8684f0e927',
    'ce7cdb99-6efa-4b61-9313-4ac64ae0f72c',
    'b830f951-6173-4877-b6f8-cdcbe2b15f9a',
    'c5e02fc4-a6af-4e0f-8d37-2e1e18d9c8f5',
    '3151d12b-5c15-4f68-ad71-645315e8a4c7',
    'b1e60081-41d4-4865-b710-d61b2b8f5a9e'
)
ORDER BY symbol, order_time;
"
```

### 3. Recompute FIFO with Complete Data
```bash
python -m scripts.compute_allocations --version 2 --all-symbols
```

### 4. Validate Version 2
```bash
python -m scripts.validate_allocations --version 2
```

### 5. Compare Results
```bash
# Version 1 (incomplete data)
python -m scripts.allocation_reports --version 1 --summary

# Version 2 (with backfilled buys)
python -m scripts.allocation_reports --version 2 --summary
```

---

## Expected Outcome

After backfilling these 11 buys:

**Version 1 (Current):**
- Unmatched sells: 19
- Total PnL: -$1,142.99

**Version 2 (After backfill) - Expected:**
- Unmatched sells: 8 or fewer (down from 19)
- Total PnL: More accurate (should change based on cost basis)

The 11 missing buys will provide cost basis for matching sells, which should:
1. Reduce unmatched sells count
2. Adjust PnL calculations
3. Provide complete audit trail

---

## Questions to Investigate

1. **Why were these specific buys missing?** Check import logs for 2025-09 to 2025-11
2. **Are there more missing trades?** Consider running Tier 2 (weekly reconciliation)
3. **How to prevent future gaps?** Add reconciliation to daily workflow
4. **Should we backfill or re-import?** Backfill is faster, re-import is more thorough

---

**Status:** Ready for manual verification
**Next Step:** Verify 3-5 high-priority order_ids on Coinbase exchange, then proceed with auto-backfill
